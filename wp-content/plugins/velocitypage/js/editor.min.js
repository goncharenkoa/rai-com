(function(){var a,b,c=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},d={}.hasOwnProperty,e=function(a,b){return function(){return a.apply(b,arguments)}};a=window.jQuery,a(function(){var b,c,d,e,f,g,h;return f=null,g=function(){return f=a(".vp-panel.active .vp-panel-body")},b=a(window),d=a("#velocity-page-wrapper"),g(),e=a(".vp-page-controls"),e.on("changePanel",function(){return g(),h()}),h=function(){return f.length?f.css({height:b.height()-f.position().top+"px"}):void 0},c=_.debounce(h,50),h(),b.resize(c),d.fitVids()}),function(a,b){var c,d;return c=b(document),d=function(a){return a=a.replace(/[ -]+/g," "),a=a.replace(/[^A-Za-z0-9 ]/g,""),a=a.toLowerCase(),a=a.replace(/[ ]+/g,"-"),a=a.replace(/^-+|-+$/g,"")},b(function(){var e,f,g,h,i,j,k,l,m,n,o,p,q;return h=b("#wpadminbar"),o=b("ul.vp-quick-controls"),q=h.find("li#wp-admin-bar-velocitypage"),n={},n.transition=b(".vp-transition-panel"),n.addnew=b(".vp-addnew-panel"),m=!1,f=n.addnew.find(".vp-addnew-title"),g=n.addnew.find(".vp-addnew-url span"),e=n.addnew.find("#vp-page-parent"),l=b(".vp-page-controls"),j=function(){return h.find("li.menupop.hover")},p=function(){var a,b,c;return a=e.find(":selected"),b="0"===a.val()?"":vpAllPageURLs[a.val()],c=d(f.val()).length?d(f.val())+"/":"",g.text(""+b+c),g.parent().toggle(""!==c)},k=function(a){return i(),o.hide(),n[a].show().addClass("active"),l.trigger("changePanel"),m=!0,j().removeClass("hover"),q.addClass("vp-hover")},i=function(){var a,b;for(a in n)b=n[a],b.hide().removeClass("active");return m=!1,o.show(),q.removeClass("vp-hover")},c.on("keyup",function(a){return m&&27===a.which?i():void 0}),c.on("click","#wp-admin-bar-velocitypage-choose",function(a){return a.preventDefault(),k("transition")}),c.on("click",".vp-panel-cancel a",function(a){return a.preventDefault(),i()}),c.on("click","#wp-admin-bar-velocitypage-addnew",function(a){return a.preventDefault(),k("addnew"),n.addnew.find(".vp-addnew-title").focus()}),c.on("keyup",".vp-addnew-panel .vp-addnew-title",p),c.on("change",e,p),-1!==a.location.toString().indexOf("vp-instant-transition=1")&&(b("#wp-admin-bar-velocitypage-choose").click(),a.history&&a.history.pushState)?a.history.replaceState({},"",a.location.toString().replace(/[?&]vp-instant-transition=1/,"")):void 0})}(window,window.jQuery),a=window.jQuery,a.fn.vpSetAllToMaxHeight=function(){return this.css("height","auto"),this.css({"min-height":Math.max.apply(this,a.map(this.children(),function(b){return a(b).height()}))})},b=window.velocityPageApp={Models:[],Views:[],Collections:[],expectations:{items:{},rows:{}},events:_.extend({},Backbone.Events),namespace:"wp.adlabs.vp",log:function(){return console.log.apply(console,arguments)},cleanURL:function(){return window.history&&window.history.pushState?(window.history.replaceState({},"",window.location.toString().replace(/[?&]vp-transition=[a-z0-9-_]+/,"")),window.history.replaceState({},"",window.location.toString().replace(/[?&]vp-layout=[a-z0-9-_]+/,""))):void 0},start:function(){return a(function(c){return function(){var d;return d=a("body"),d.on("click."+c.namespace,"li.vp-start-page, #wp-admin-bar-velocitypage-edit",function(c){return c.preventDefault(),a("li.vp-start-page").hide(),a("#wp-admin-bar-velocitypage-edit").hide(),a("li.vp-save-page").show(),a("#wp-admin-bar-velocitypage-save").removeClass("vp-hidden"),a("#velocity-page-wrapper").addClass("vp-editing"),b.edit(),b.page.get("demo")&&a(".vp-page-controls").hide(),b.page.get("transitioning")?b.cleanURL():void 0}),d.on("click."+c.namespace,"li.vp-save-page, #wp-admin-bar-velocitypage-save",function(b){var d,e;return a(".vp-transition-panel").remove(),a("#wp-admin-bar-velocitypage-choose").remove(),b.preventDefault(),c.page.setMessage("Saving..."),d=function(){var a;return c.page.setMessage("Saved!"),a=function(){return c.page.clearMessage()},_.delay(a,2e3)},e=c.page.save(),e.done(function(){return c.initialPage=c.page.toJSON(),_.delay(d,500)}),e.fail(function(a){var b;return b=a.message||"saving failed",c.page.setMessage("ERROR: "+b)})})}}(this))},getSelectionPos:function(a){var b,c,d,e,f;return e=0,f=0,b=void 0,window.getSelection?(d=window.getSelection(),d.rangeCount&&(b=d.getRangeAt(d.rangeCount-1).cloneRange(),c=b.getBoundingClientRect(),a?(e=c.left,f=c.top):(e=c.right,f=c.bottom))):document.selection&&"Control"!==document.selection.type&&(b=document.selection.createRange(),b.collapse(a),e=b.boundingLeft,f=b.boundingTop),{x:e,y:f}},isTransparentColor:function(a){return"transparent"===a||"rgba"===a.substring(0,4)},getBackgroundColor:function(a){return window.getComputedStyle(a,null).backgroundColor},equalizeColumns:function(){return a(".row-wrap").each(function(){return a(this).find(".item-area-wrap").vpSetAllToMaxHeight()})},template:function(c){return b.log("Templating "+c),a("#tmpl-"+c).length>0||b.log("ERROR: #tmpl-"+c+" does not exist!"),wp.template(c)},loadData:function(){var a,c,d,e,f;this.page.set({id:this.pageData.id}),this.page.set({theme:this.pageData.theme}),this.page.set({demo:this.pageData.demo}),this.page.set({transitioning:this.pageData.transitioning}),d=this.pageData.fields;for(c in d)a=d[c],this.page.fields[c]=new b.Models.Field(a.data,a.options);e=this.pageData.rowAreas;for(c in e)f=e[c],this.page.rowAreas[c]=new this.Collections.RowArea(null,_.extend(f.options,{data:f.data}));return this.initialPage=this.page.toJSON()},mceInit:function(c){return tinymce.init({selector:c,inline:!0,browser_spellcheck:!0,plugins:"autolink lists link anchor",toolbar1:"bold italic link | bullist numlist",toolbar2:"alignleft aligncenter alignright | removeformat",menubar:!1,fixed_toolbar_container:"#vp-tinymce-toolbar",skin:"lightgray",object_resizing:!1,relative_urls:!1,convert_urls:!1,valid_elements:"*[*]",setup:function(c){var d;return d=a("#vp-tinymce-toolbar"),c.on("keyup mouseup",function(){var c,e,f,g,h;return h=b.getSelectionPos(!0),c=b.getSelectionPos(!1),b.log("selectionPos yes",h),b.log("selectionPos no",c),f=_.max([h.x,c.x]),e=_.min([h.x,c.x]),d.css("position","absolute"),d.css({left:f+(e-f)/2-d.width()/2+"px",top:_.max([c.y,h.y])+5+a(window).scrollTop()+"px"}),b.log("left",f+(e-f)/2-d.width()/2+"px"),g=window.getSelection(),g.isCollapsed?d.removeClass("fee-active").hide():d.addClass("fee-active").show(),b.log(g)}),c.on("mousedown blur",function(){return d.removeClass("fee-active").hide()}),c.on("focus",function(b){return a(".fee-element.fee-active").removeClass("fee-active"),d.addClass("fee-active").show()}),c.on("blur",function(a){return d.removeClass("fee-active").hide()})}})},edit:function(){return this.events.trigger("editMode:on"),a(function(b){return function(){var c,d,e;return a("head").append('<link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">'),a.getScript("//tinymce.cachefly.net/4.0/tinymce.min.js").done(function(){return b.mceInit(".vp-editable.vp-block"),b.events.trigger("mce:ready")}),b.pageView.render(),a("#velocity-page-wrapper").parents().each(function(){var b;return b=a(this),"hidden"===b.css("overflow")&&b.addClass("vp-clearfix"),b.css({overflow:"visible"})}),d=_.throttle(b.equalizeColumns,100),e=_.throttle(b.equalizeColumns,2e3),d(),c=a(window),c.on("resize click keyup",d),c.on("mousemove",e),b.devMode?void 0:window.onbeforeunload=function(){return b.page.get("demo")||_.isEqual(b.page.toJSON(),b.initialPage)?void 0:"You have unsaved changes!"}}}(this)),this}},b.Models.Page=function(a){function d(){return d.__super__.constructor.apply(this,arguments)}return c(d,a),d.prototype.initialize=function(){return this.fields={},this.rowAreas={}},d.prototype.toJSON=function(){var a,b,c,d,e,f;e={fields:{},rowAreas:{}},c=this.fields;for(b in c)a=c[b],e.fields[b]=a.toJSON();d=this.rowAreas;for(b in d)f=d[b],e.rowAreas[b]=f.toJSON();return e.theme=this.get("theme"),e},d.prototype.save=function(){var a;return a={context:this,data:{post_id:this.id,method:"update",data:JSON.stringify(this.toJSON()),_ajax_nonce:b.nonce}},b.log("options.data",a.data),wp.ajax.send("velocity-page",a)},d.prototype.parse=function(){return!1},d.prototype.setMessage=function(a){return b.log("Setting message on model to",a),this.set({message:a})},d.prototype.clearMessage=function(){return this.unset("message")},d}(Backbone.Model),b.Models.Row=function(a){function d(){return d.__super__.constructor.apply(this,arguments)}return c(d,a),d.prototype.initialize=function(a,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y;if(this.listenTo(this,"switchStyle",this.switchStyle),this.fields={},this.itemAreas={},null!=c?c.fields:void 0){p=c.fields;for(m in p)e=p[m],this.fields[m]=new b.Models.Field(e.data,e.options)}else if(null!=(q=b.expectations.rows[a.slug])?q.fields:void 0){s=null!=(r=b.expectations.rows[a.slug])?r.fields:void 0;for(m in s)e=s[m],this.fields[m]=new b.Models.Field({slug:e,id:m})}if(null!=c?c.itemAreas:void 0){t=c.itemAreas;for(m in t)i=t[m],i.options.name=m,this.itemAreas[m]=new b.Collections.ItemArea(null,i.options)}else if(null!=(u=b.expectations.rows[a.slug])?u.item_areas:void 0){w=null!=(v=b.expectations.rows[a.slug])?v.item_areas:void 0;for(m in w)i=w[m],this.itemAreas[m]=new b.Collections.ItemArea(null,{slug:i,id:m});if(null!=(null!=c?c.oldModelItemAreas:void 0)){if(o=_.size(null!=c?c.oldModelItemAreas:void 0),n=_.size(null!=(x=b.expectations.rows[a.slug])?x.item_areas:void 0),o&&n&&o>n)for(d=["default","second","third"],d=_.first(d,o),g=_.last(d,o-n),j=_.difference(d,g),k=_.last(j),h=0,l=g.length;l>h;h++)f=g[h],c.oldModelItemAreas[k].add(c.oldModelItemAreas[f].models),delete c.oldModelItemAreas[f];y=c.oldModelItemAreas;for(m in y)i=y[m],this.itemAreas[m]=i}}return this.set({id:this.cid})},d.prototype.switchStyle=function(){var a;return a=this.get("style"),this.set({style:"alt"===a?null:"alt"})},d.prototype.toJSON=function(){var a,b,c,e,f,g;g=d.__super__.toJSON.apply(this,arguments),g.fields={},g.itemAreas={},e=this.fields;for(c in e)a=e[c],g.fields[c]=a.toJSON();f=this.itemAreas;for(c in f)b=f[c],g.itemAreas[c]=b.toJSON();return g},d}(Backbone.Model),b.Models.Item=function(a){function d(){return d.__super__.constructor.apply(this,arguments)}return c(d,a),d.prototype.initialize=function(a,c){var d,e,f,g,h,i,j,k,l,m;if((null!=a?a.align:void 0)||null!=a&&delete a.align,this.switching=!_.isEmpty(null!=c?c.oldModelFields:void 0),this.fields={},null!=c?c.fields:void 0){g=c.fields;for(e in g)d=g[e],this.fields[e]=new b.Models.Field(d.data,d.options)}else if(null!=(h=b.expectations.items[a.slug])?h.fields:void 0){b.log("second branch",null!=c),j=null!=(i=b.expectations.items[a.slug])?i.fields:void 0;for(e in j)d=j[e],f={slug:d,id:e},this.fields[e]=(null!=c&&null!=(k=c.oldModelFields)?k[e]:void 0)?new b.Models.Field(_.extend(c.oldModelFields[e].toJSON(),f),{autofocus:!1}):new b.Models.Field(f,{autofocus:(null!=c?c.autofocus:void 0)||!1}),null!=c&&(c.autofocus=!1)}this.set({id:this.cid}),this.listenTo(this,"editMode",this.editMode),this.listenTo(this,"editLink:show",this.editLink),this.listenTo(this,"chooseImage",this.chooseImage),this.listenTo(this,"add",this.add),l=this.fields,m=[];for(e in l)d=l[e],this.listenTo(d,"editMode",this.editMode),m.push(this.listenTo(d,"itemHeightCheck",this.heightCheck));return m},d.prototype.add=function(a,b,c){var d,e,f,g;f=this.fields,g=[];for(e in f)d=f[e],g.push(d.trigger("add",a,b,c));return g},d.prototype.heightCheck=function(){return this.trigger("heightCheck")},d.prototype.editLink=function(){var a,b,c,d;c=this.fields,d=[];for(b in c)a=c[b],d.push(a.trigger("editLink:show"));return d},d.prototype.editMode=function(a,b){var c,d,e,f;if(b===this){e=this.fields,f=[];for(d in e)c=e[d],f.push(c.trigger("editMode",a,c));return f}},d.prototype.chooseImage=function(){var a,b,c,d;c=this.fields,d=[];for(b in c)a=c[b],d.push(a.trigger("chooseImage"));return d},d.prototype.toJSON=function(){var a,b,c,e;e=d.__super__.toJSON.apply(this,arguments),e.fields={},c=this.fields;for(b in c)a=c[b],e.fields[b]=a.toJSON();return e},d}(Backbone.Model),b.Models.Field=function(a){function d(){return d.__super__.constructor.apply(this,arguments)}return c(d,a),d.prototype.initialize=function(a,c){var d;return b.log("Field initialize options:",c),this.get("value")||(d=function(){switch(a.slug){case"text":case"p":return"<p>Add text here</p>";case"h1":case"h2":case"h3":case"h4":return"Add text here";case"spacer":return 100;default:return""}}(),this.set({value:d})),this.set({autofocus:(null!=c?c.autofocus:void 0)||!1})},d}(Backbone.Model),b.Collections.RowArea=function(a){function d(){return d.__super__.constructor.apply(this,arguments)}return c(d,a),d.prototype.model=b.Models.Row,d.prototype.initialize=function(a,c){var d,e,f,g,h,i;for(d=c.data,b.log("Collections.RowArea.initialize()",c),this.listenTo(this,"move",this.move),this.listenTo(this,"removeFromCollection",this.remove),this.listenTo(this,"chooseRowType",this.replaceWithType),this.listenTo(this,"wantsNewType",this.wantsNewType),this.slug=d.slug||"default",g=c.rows,h=[],e=0,f=g.length;f>e;e++)i=g[e],h.push(this.add(new b.Models.Row(i.data,i.options)));return h},d.prototype.replaceWithType=function(a,c){var d,e;return d=this.indexOf(a),b.log("position",d),this.remove(a),e=new b.Models.Row({slug:c},{autofocus:!0,oldModelItemAreas:a.get("oldModelItemAreas")||null}),a.set({oldModelItemAreas:null}),this.add(e,{at:d})},d.prototype.wantsNewType=function(a){var b;return b=this.indexOf(a),this.remove(a),this.addRow(a,{at:b})},d.prototype.move=function(a,c){return b.log("Moving row",c,a),-1!==c&&a!==this.at(c)?(this.remove(a,{shh:!0}),this.add(a,{at:c,shh:!0})):void 0},d.prototype.addRow=function(a,c){var d;return b.log("COLLECTION: adding a row",{model:a,options:c}),d=new b.Models.Row({slug:"chooser",oldModelItemAreas:(null!=a?a.itemAreas:void 0)||null,oldModel:a}),d.autofocus=!0,this.add(d,_.extend({},c))},d}(Backbone.Collection),b.Collections.ItemArea=function(a){function d(){return d.__super__.constructor.apply(this,arguments)}return c(d,a),d.prototype.model=b.Models.Item,d.prototype.initialize=function(a,c){var d,e,f,g,h;if(b.log("Collections.ItemArea.initialize()",a,c),this.listenTo(this,"move",this.move),this.listenTo(this,"removeFromCollection",this.remove),this.listenTo(this,"wantsNewType",this.wantsNewType),this.listenTo(this,"chooseItemType",this.replaceWithType),null!=c?c.items:void 0){for(this.name=c.name,g=c.items,h=[],d=0,f=g.length;f>d;d++)e=g[d],b.log("ITEM",e.data,e.options),h.push(this.add(new b.Models.Item(e.data,e.options)));return h}},d.prototype.replaceWithType=function(a,c){var d,e,f;return d=this.indexOf(a),b.log("position",d),this.remove(a),e=new b.Models.Item({slug:c,align:(null!=a&&"function"==typeof a.get&&null!=(f=a.get("oldModel"))&&"function"==typeof f.get?f.get("align"):void 0)||null},{autofocus:!0,oldModelFields:a.get("oldModelFields")||null}),e.chooseImageImmediately=!0,this.add(e,{at:d})},d.prototype.wantsNewType=function(a){var b;return b=this.indexOf(a),this.remove(a),this.addItem(a,{at:b})},d.prototype.move=function(a,c){return-1!==c&&a!==this.at(c)?(b.log("Moving item",c,a),this.remove(a,{shh:!0}),this.add(a,{at:c,shh:!0})):void 0},d.prototype.addItem=function(a,c){var d;return b.log("COLLECTION: adding an item",{model:a,options:c}),d=new b.Models.Item({slug:"chooser",oldModelFields:(null!=a?a.fields:void 0)||null,oldModel:a}),d.autofocus=!0,this.add(d,c||{}),b.log("Models",this.models)},d}(Backbone.Collection),b.Views.Base=function(a){function b(a){(null!=a?a.template:void 0)&&(this.template=a.template),b.__super__.constructor.apply(this,arguments)}return c(b,a),b}(wp.Backbone.View),b.Views.Page=function(d){function e(){return e.__super__.constructor.apply(this,arguments)}var f;return c(e,d),e.prototype.template=b.template("velocity-page-wrapper"),e.prototype.id="velocity-page-inner-wrapper",e.prototype.events={keydown:"keydown",mousemove:"mousemove"},f=[0,0],e.prototype.initialize=function(){return this.listenTo(this.model,"change:message",this.updateMessage),this.listenTo(b.events,"drag:start",this.dragStart),this.listenTo(b.events,"drag:stop",this.dragStop)},e.prototype.keydown=function(){return this.$el.addClass("typing")},e.prototype.mousemove=function(a){var b;return b=_.clone(this.mousePosition),this.mousePosition=[a.pageX,a.pageY],_.isEqual(b,this.mousePosition)?void 0:this.$el.removeClass("typing")},e.prototype.setSubviews=function(){var a,c,d,e,f;d=this.model.fields;for(c in d)a=d[c],b.log("adding the page '"+c+"' field subview"),this.views.set(".page-field-wrap-"+c,new b.Views.Field({template:b.template("field-"+a.get("slug")),model:a}));e=this.model.rowAreas;for(c in e)f=e[c],b.log("adding the page '"+c+"' rowArea subview",f),this.views.set(".page-row-area-wrap-"+c,new b.Views.RowArea({template:b.template("row-area-"+f.slug),collection:f}));return this},e.prototype.dragStart=function(a){return this.$body.addClass("dragging dragging-"+a),b.log("drag:start")},e.prototype.dragStop=function(a){return this.$body.removeClass("dragging dragging-"+a),b.log("drag:stop")},e.prototype.updateMessage=function(a,c){return null==c&&(c=""),b.log("MESSAGE",c),this.$message.html(c),this.$message.toggle(!_.isEmpty(c))},e.prototype.ready=function(){return this.$message=a(".vp-message"),this.$body=a("body")},e.prototype.render=function(){return this.views.length||this.setSubviews(),e.__super__.render.apply(this,arguments),b.log("rendered HTML"),a("#velocity-page-wrapper").html(this.el),b.log("added page HTML to DOM"),this.views.ready(),b.log("announced ready"),this},e}(wp.Backbone.View),b.Views.RowArea=function(a){function d(){return d.__super__.constructor.apply(this,arguments)}return c(d,a),d.prototype.tagName="div",d.prototype.className="row-area-wrap",d.prototype.initialize=function(){return this.listenTo(this.collection,"add",this.addView),this.listenTo(this.collection,"add remove change",this.setClasses),this.listenTo(this.collection,"setClasses",this.setClasses),this.listenTo(this.collection,"mouseOver",this.mouseOver),this.listenTo(this.collection,"mouseOut",this.mouseOut),this.setViews()},d.prototype.mouseOver=function(a){return a===this.collection?this.$el.addClass("hovered"):void 0},d.prototype.mouseOut=function(a){return a===this.collection?this.$el.removeClass("hovered"):void 0},d.prototype.addView=function(a,b,c){var d;return(null!=c?c.shh:void 0)?void 0:(d=this.newView(a),this.views.add(".row-area-row-wrap",d,{at:null!=c?c.at:void 0}))},d.prototype.newView=function(a){return new b.Views.Row({template:b.template("row-"+a.get("slug")),model:a})},d.prototype.setViews=function(){var a;return this.views.set(".row-area-row-wrap",function(){var b,c,d,e;for(d=this.collection.models,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(this.newView(a));return e}.call(this)),this.views.set(".row-area-controls-wrap",new b.Views.RowAreaControls({template:b.template("controls-row-area"),collection:this.collection}))},d.prototype.postRender=function(){return this.setClasses()},d.prototype.postRenderOnce=function(){var a;return a=this.$(".row-area-row-wrap"),this.$el.hoverIntent({over:function(a){return function(){return a.collection.trigger("mouseOver",a.collection)}}(this),out:function(a){return function(){return a.collection.trigger("mouseOut",a.collection)}}(this),timeout:1e3,interval:40}),a.sortable({axis:"y",cursor:"move",handle:".vp-sort-handle",items:"> .row-wrap",tolerance:"pointer",placeholder:"sortable-placeholder",start:function(c,d){var e,f,g;return f=b.getBackgroundColor,g=b.isTransparentColor,e=d.item.css("background-color"),d.item.data("originalCSS",{"max-height":d.item.css("max-height"),overflow:d.item.css("overflow")}),g(e)&&d.item.parents().each(function(){return g(f(this))?void 0:(e=f(this),!1)}),g(e)&&(e="#fff"),d.item.css({"background-color":e,overflow:"hidden","max-height":"300px"}),d.placeholder.css({height:d.helper.css("height"),"max-height":"300px","margin-top":d.helper.css("margin-top"),"margin-bottom":d.helper.css("margin-bottom"),"padding-top":d.helper.css("padding-top"),"padding-bottom":d.helper.css("padding-bottom")}),a.sortable("refreshPositions"),b.events.trigger("drag:start","row")},update:function(a,b){return b.item.trigger("move",b.item.index())},stop:function(a,c){return c.item.data("originalCSS")&&c.item.css(c.item.data("originalCSS")),c.item.css("background-color",""),b.events.trigger("drag:stop","row"),c.item.find(".field-wrap").trigger("drag:stop")}})},d.prototype.setClasses=function(){var a;return b.log("setClasses()",this.collection.length+" rows"),a=this.$(".row-area-row-wrap"),a.attr("class",a.attr("class").replace(/\s*row-count-[0-9]+/,"")),a.addClass("row-count-"+this.collection.length),b.log("setClasses()",this),this.slug?this.$el.addClass("row-area-wrap-slug-"+this.slug):void 0},d.prototype.ready=function(){return b.log("RowArea.ready"),this.postRenderOnce(),this.postRender()},d}(b.Views.Base),b.Views.RowAreaControls=function(a){function d(){return d.__super__.constructor.apply(this,arguments)}return c(d,a),d.prototype.tagName="div",d.prototype.className="controls-wrap controls-wrap-row-area",d.prototype.events={"click .vp-add":"addRow"},d.prototype.initialize=function(){return this.listenTo(this.collection,"mouseOver",this.mouseOver),this.listenTo(this.collection,"mouseOut",this.mouseOut),this.listenTo(this.collection,"add",this.add),this.listenTo(this.collection,"remove",this.remove)},d.prototype.mouseOver=function(a){return a!==this.collection||this.$el.hasClass("ui-sortable-helper")?void 0:this.$el.fadeIn(100)},d.prototype.mouseOut=function(a){return a===this.collection&&!this.$el.hasClass("ui-sortable-helper")&&this.collection.length?this.$el.fadeOut():void 0},d.prototype.addRow=function(a){return b.log("Adding a row"),a.preventDefault(),this.collection.addRow()},d.prototype.add=function(){return this.alterAddButton("add")},d.prototype.remove=function(){return this.alterAddButton("remove")},d.prototype.alterAddButton=function(a){return this.$el.toggleClass("vp-empty",0===this.collection.length),1===this.collection.length&&"add"===a?this.$el.show():void 0},d.prototype.ready=function(){return b.log("RowAreaControls.ready"),this.alterAddButton()},d}(b.Views.Base),b.Views.ItemArea=function(d){function e(){return e.__super__.constructor.apply(this,arguments)}return c(e,d),e.prototype.tagName="div",e.prototype.className="item-area-wrap",e.prototype.initialize=function(a){return this.itemArea=this.collection,this.slug=a.slug,this.listenTo(this.itemArea,"add",this.addView),this.listenTo(this.itemArea,"change add remove",this.setClasses),this.listenTo(this.itemArea,"mouseOver",this.mouseOver),this.listenTo(this.itemArea,"mouseOut",this.mouseOut),this.setViews()},e.prototype.mouseOver=function(a){return a===this.itemArea?this.$el.addClass("hovered"):void 0},e.prototype.mouseOut=function(a){return a===this.itemArea?this.$el.removeClass("hovered"):void 0},e.prototype.addView=function(a,c,d){var e;return(null!=d?d.shh:void 0)?void 0:(e=this.newView(a),b.log("newView",e),this.views.add(".item-area-item-wrap",e,{at:null!=d?d.at:void 0}))},e.prototype.newView=function(a){return new b.Views.Item({template:b.template("item-"+a.get("slug")),model:a,slug:a.get("slug")})},e.prototype.setViews=function(){var a;return this.views.set(".item-area-item-wrap",function(){var b,c,d,e;for(d=this.itemArea.models,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(this.newView(a));return e}.call(this)),this.views.set(".item-area-controls-wrap",new b.Views.ItemAreaControls({template:b.template("controls-item-area"),collection:this.itemArea}))},e.prototype.postRender=function(){return this.setClasses()},e.prototype.postRenderOnce=function(){var c,d;return d=this.$(".item-area-item-wrap"),this.$el.hoverIntent({over:function(a){return function(){return a.itemArea.trigger("mouseOver",a.itemArea)}}(this),out:function(a){return function(){return a.itemArea.trigger("mouseOut",a.itemArea)}}(this),timeout:1e3,interval:40}),c=this.itemArea,d.sortable({cursor:"move",handle:".vp-sort-handle",items:"> .item-wrap",placeholder:"sortable-placeholder",connectWith:".item-area-item-wrap",tolerance:"pointer",cursorAt:{left:5,top:5},start:function(a,c){var e,f,g;return f=b.getBackgroundColor,g=b.isTransparentColor,e=c.item.css("background-color"),c.item.data("originalCSS",{"max-height":c.item.css("max-height"),overflow:c.item.css("overflow")}),g(e)&&c.item.parents().each(function(){return g(f(this))?void 0:(e=f(this),!1)}),g(e)&&(e="#fff"),c.item.css({"background-color":e,"max-height":"150px",overflow:"hidden"}),c.placeholder.css({height:c.helper.css("height"),"max-height":"150px","margin-top":c.helper.css("margin-top"),"margin-bottom":c.helper.css("margin-bottom"),"padding-top":c.helper.css("padding-top"),"padding-bottom":c.helper.css("padding-bottom")}),d.sortable("refreshPositions"),b.events.trigger("drag:start","item")},stop:function(a,c){return c.item.data("originalCSS")&&c.item.css(c.item.data("originalCSS")),c.item.css("background-color",""),b.events.trigger("drag:stop","item"),c.item.find(".field-wrap").trigger("drag:stop")},update:function(d,e){var f;return b.log("UPDATE",{text:e.item.text().trim(),index:e.item.index(),model:e.item.data("backbone-model"),name:c.name,inThisView:a.contains(this,e.item.get(0)),isNew:-1===c.indexOf(e.item.data("backbone-model"))}),a.contains(this,e.item.get(0))?(f=e.item.data("backbone-model"),c.trigger("move",f,e.item.index())):void 0},remove:function(d,e){var f;return b.log("REMOVE",{text:e.item.text().trim(),index:e.item.index(),model:e.item.data("backbone-model"),name:c.name,inThisView:a.contains(this,e.item.get(0)),isNew:-1===c.indexOf(e.item.data("backbone-model"))}),f=e.item.data("backbone-model"),c.remove(f,{shh:!0})}})},e.prototype.setClasses=function(){var a;return b.log("setClasses()",this.itemArea.length+" items"),a=this.$(".item-area-item-wrap"),a.attr("class",a.attr("class").replace(/\s*item-count-[0-9]+/,"")),a.addClass("item-count-"+this.itemArea.length),b.log("setClasses()",this),this.$el.addClass("item-area-wrap-slug-"+this.slug)},e.prototype.ready=function(){return b.log("ItemArea.ready"),this.postRenderOnce(),this.postRender()},e}(b.Views.Base),b.Views.ItemAreaControls=function(a){function d(){return d.__super__.constructor.apply(this,arguments)}return c(d,a),d.prototype.tagName="div",d.prototype.className="controls-wrap controls-wrap-item-area",d.prototype.events={"click .vp-add":"addItem"},d.prototype.initialize=function(){return this.listenTo(this.collection,"mouseOver",this.mouseOver),this.listenTo(this.collection,"mouseOut",this.mouseOut),this.listenTo(this.collection,"add",this.alterAddButton),this.listenTo(this.collection,"remove",this.alterAddButton),this.listenTo(this.collection,"hoveredHalf",this.moveControls)},d.prototype.moveControls=function(a,c){var d,e,f,g;return b.log("Hovered over "+c+" of "+a.model.get("id")),g=a.$el.position().top,d=g+a.$el.height(),e=this.collection.indexOf(a.model),"top"===c?f=g-12+5+1:(e++,f=d+12-5-1),this.hoveredLocation=e,this.$el.css({bottom:"auto",top:f+"px"}),b.log(a.$el.position().top)},d.prototype.mouseOver=function(a){return a!==this.collection||this.$el.hasClass("ui-sortable-helper")?void 0:this.$el.fadeIn(100)},d.prototype.mouseOut=function(a){return a!==this.collection||this.$el.hasClass("ui-sortable-helper")?void 0:this.$el.fadeOut()},d.prototype.addItem=function(a){return b.log("Adding an item"),a.preventDefault(),this.collection.addItem({},{at:this.hoveredLocation||0})},d.prototype.alterAddButton=function(){return this.$el.toggleClass("vp-empty",0===this.collection.length)},d.prototype.ready=function(){return b.log("ItemAreaControls.ready"),this.alterAddButton()},d}(b.Views.Base),b.Views.Row=function(d){function e(){return e.__super__.constructor.apply(this,arguments)}return c(e,d),e.prototype.tagName="div",e.prototype.className="row-wrap",e.prototype.events={move:"move","click .row > ul.vp-choose-type a":"chooseRowType","click .vp-sort-handle":"preventDefault"},e.prototype.initialize=function(){var a,c,d,e,f,g,h,i,j;f=this.model.fields;for(e in f)a=f[e],this.views.set(".row-field-wrap-"+e,new b.Views.Field({template:b.template("field-"+a.get("slug")),model:a}));g=this.model.itemAreas;for(e in g)c=g[e],d=null!=(h=b.expectations.rows[this.model.get("slug")])?h.item_areas[e]:void 0,this.views.set(".row-item-area-wrap-"+e,new b.Views.ItemArea({template:b.template("item-area-"+d),collection:c,slug:d}));this.views.set(".row-controls-wrap",new b.Views.RowControls({template:b.template("controls-row"),model:this.model})),this.listenTo(this.model,"userRemove",this.userRemove),this.listenTo(this.model,"remove",this.maybeRemove),this.listenTo(this.model,"mouseOver",this.mouseOver),this.listenTo(this.model,"mouseOut",this.mouseOut),this.listenTo(this.model,"change:style",this.updateStyle),i=this.model.itemAreas,j=[];for(e in i)c=i[e],j.push(this.listenTo(c,"add remove change",this.equalizeColumns));return j},e.prototype.equalizeColumns=function(){return b.equalizeColumns()},e.prototype.mouseOver=function(a){return a===this.model?this.$el.addClass("hovered"):void 0},e.prototype.mouseOut=function(a){return a===this.model?this.$el.removeClass("hovered"):void 0},e.prototype.maybeRemove=function(a,b,c){return(null!=c?c.shh:void 0)?void 0:this.remove()},e.prototype.updateStyle=function(a,b,c){return this.$el.toggleClass("vp-alt-style","alt"===b)},e.prototype.chooseRowType=function(c){var d,e;return c.preventDefault(),e=a(c.target),d=e.data("slug"),b.log("clicked type:",d),this.remove(),this.model.trigger("chooseRowType",this.model,d)},e.prototype.preventDefault=function(a){return a.preventDefault()},e.prototype.userRemove=function(a){return this.$el.slideUp(400,function(){return a.trigger("removeFromCollection",a)})},e.prototype.move=function(a,b){return this.model.trigger("move",this.model,b)},e.prototype.postRender=function(){return this.setClasses(),this.$el.toggleClass("vp-alt-style","alt"===this.model.get("style"))},e.prototype.setClasses=function(){return this.model.get("slug")?this.$el.addClass("row-wrap-slug-"+this.model.get("slug")):void 0},e.prototype.ready=function(){return b.log("================================="),b.log("Row.ready"),this.postRender(),this.model.autofocus&&(delete this.model.autofocus,this.$el.scrollintoview(),b.log("scrollintoview()")),this.$el.hoverIntent({over:function(a){return function(){return a.model.trigger("mouseOver",a.model)}}(this),out:function(a){return function(){return a.model.trigger("mouseOut",a.model)}}(this),timeout:500,interval:40})},e}(b.Views.Base),b.Views.RowControls=function(a){function d(){return this.selfMouseOut=e(this.selfMouseOut,this),this.selfMouseOver=e(this.selfMouseOver,this),d.__super__.constructor.apply(this,arguments)}return c(d,a),d.prototype.tagName="div",d.prototype.className="controls-wrap controls-wrap-row",d.prototype.events={"click .vp-remove":"userRemove","click .vp-change":"launchRowTypeChooser","click .vp-switch-style":"switchStyle"},d.prototype.initialize=function(){return this.listenTo(this.model,"mouseOver",this.mouseOver),this.listenTo(this.model,"mouseOut",this.mouseOut)},d.prototype.mouseOver=function(a){return a!==this.model||this.$el.hasClass("ui-sortable-helper")?void 0:this.$el.css("display","block")},d.prototype.mouseOut=function(a){return a!==this.model||this.$el.hasClass("ui-sortable-helper")?void 0:this.$el.css("display","none")},d.prototype.selfMouseOver=function(){return this.more.show()},d.prototype.selfMouseOut=function(){return this.more.hide()},d.prototype.userRemove=function(a){return a.preventDefault(),this.model.trigger("userRemove",this.model)},d.prototype.launchRowTypeChooser=function(a){return a.preventDefault(),this.model.trigger("wantsNewType",this.model)},d.prototype.switchStyle=function(a){return a.preventDefault(),this.model.trigger("switchStyle",this.model)},d.prototype.ready=function(){return b.log("RowControls.ready"),this.more=this.$("div.vp-more"),this.$el.hoverIntent({over:this.selfMouseOver,out:this.selfMouseOut,timeout:1e3,interval:40})},d}(b.Views.Base),
b.Views.Item=function(d){function e(){return e.__super__.constructor.apply(this,arguments)}return c(e,d),e.prototype.tagName="div",e.prototype.className="item-wrap",e.prototype.events={"click > ul .vp-choose-type":"chooseItemType","click .vp-sort-handle":"preventDefault",mousemove:"mousemove"},e.prototype.initialize=function(a){var c,d,e;if(this.slug=a.slug,this.model.fields){b.log("FIELDS",this.model.fields),e=this.model.fields;for(d in e)c=e[d],this.views.set(".item-field-wrap-"+d,new b.Views.Field({template:b.template("field-"+c.get("slug")),model:c}))}return this.views.set(".item-controls-wrap",new b.Views.ItemControls({template:b.template("controls-item"),model:this.model})),this.listenTo(this.model,"userRemove",this.userRemove),this.listenTo(this.model,"remove",this.maybeRemove),this.listenTo(this.model,"mouseOver",this.mouseOver),this.listenTo(this.model,"mouseOut",this.mouseOut),this.listenTo(this.model,"heightCheck",this.heightCheck),this.listenTo(this.model,"change:align",this.setAlignment),this.mousemove=_.throttle(this.mousemoveRaw,100,{trailing:!1})},e.prototype.maybeRemove=function(a,b,c){return(null!=c?c.shh:void 0)?void 0:this.remove()},e.prototype.mousemoveRaw=function(b){var c,d,e,f,g,h;return g=a(b.currentTarget),f=g.offset(),c=g.height(),e=c/2,h=b.pageY-f.top,d=h>e?"bottom":"top",this.model.trigger("hoveredHalf",this,d)},e.prototype.mouseOver=function(a){return a===this.model&&this.$el.addClass("hovered"),this.heightCheck()},e.prototype.mouseOut=function(a){return a===this.model?this.$el.removeClass("hovered"):void 0},e.prototype.heightCheck=function(){return this.model.trigger("announceHeight",this.$el.outerHeight())},e.prototype.chooseItemType=function(c){var d,e;return c.preventDefault(),e=a(c.target),d=e.data("slug"),b.log("clicked type:",d),this.remove(),this.model.trigger("chooseItemType",this.model,d)},e.prototype.userRemove=function(a){return this.$el.fadeOut(400,function(){return a.trigger("removeFromCollection",a)})},e.prototype.setAlignment=function(a,b){var c;return c=this.$(".item-field-wrap"),c.removeClass("vp-align-left vp-align-right vp-align-center"),b?c.addClass("vp-align-"+b):void 0},e.prototype.preventDefault=function(a){return a.preventDefault()},e.prototype.prepare=function(){return b.log("ITEM PREPARE",_.extend(this.model.toJSON(),{switching:this.model.switching})),_.extend(this.model.toJSON(),{switching:this.model.switching})},e.prototype.ready=function(){return this.model.chooseImageImmediately&&"image"===this.model.get("slug")&&(delete this.model.chooseImageImmediately,this.model.trigger("chooseImage")),this.model.autofocus&&(delete this.model.autofocus,this.$el.scrollintoview(),b.log("scrollintoview()")),this.setAlignment(this.model,this.model.get("align")),this.$el.data("backbone-model",this.model),this.$el.addClass("item-wrap-slug-"+this.slug),this.$el.hoverIntent({over:function(a){return function(){return a.model.trigger("mouseOver",a.model)}}(this),out:function(a){return function(){return a.model.trigger("mouseOut",a.model)}}(this),timeout:250,interval:40})},e}(b.Views.Base),b.Views.ItemControls=function(d){function f(){return this.selfMouseOut=e(this.selfMouseOut,this),this.selfMouseOver=e(this.selfMouseOver,this),f.__super__.constructor.apply(this,arguments)}return c(f,d),f.prototype.tagName="div",f.prototype.className="controls-wrap controls-wrap-item",f.prototype.events={"click .vp-remove":"userRemove","click .vp-change":"launchItemTypeChooser","click .vp-edit":"edit","click .vp-align":"alignText","click .vp-more a":"selfMouseOut","click .vp-link":"link",mouseover:"selfMouseOver"},f.prototype.initialize=function(){return this.listenTo(this.model,"mouseOver",this.mouseOver),this.listenTo(this.model,"mouseOut",this.mouseOut),this.listenTo(this.model,"announceHeight",this.adjustCorner),this.listenTo(this,"adjustCorner",this.adjustCorner)},f.prototype.userRemove=function(a){return a.preventDefault(),this.model.trigger("userRemove",this.model)},f.prototype.edit=function(a){switch(a.preventDefault(),this.model.get("slug")){case"shortcode":case"media":case"html":case"mailchimp":case"aweber":return this.model.trigger("editMode",!0,this.model);case"image":return this.model.trigger("chooseImage")}},f.prototype.adjustCorner=function(a){return null==a&&(a=0),this.$el.toggleClass("vp-round-corner",this.height>a)},f.prototype.alignText=function(b){var c,d;return b.preventDefault(),d=a(b.currentTarget),c=d.data("align"),c===this.model.get("align")?this.model.unset("align"):this.model.set({align:d.data("align")})},f.prototype.launchItemTypeChooser=function(a){return a.preventDefault(),this.model.trigger("wantsNewType",this.model)},f.prototype.link=function(a){return a.preventDefault(),this.model.trigger("editLink:show")},f.prototype.mouseOver=function(a){return a!==this.model||(this.height||(this.height=this.$el.outerHeight()),this.$el.hasClass("ui-sortable-helper"))?void 0:this.$el.css("display","block")},f.prototype.mouseOut=function(a){return a!==this.model||this.$el.hasClass("ui-sortable-helper")?void 0:this.$el.css("display","none")},f.prototype.selfMouseOver=function(){return this.more.show()},f.prototype.selfMouseOut=function(){return this.more.hide()},f.prototype.prepare=function(){return this.model.toJSON()},f.prototype.ready=function(){return b.log("ItemControls.ready"),this.more=this.$("div.vp-more"),this.$el.hoverIntent({over:this.selfMouseOver,out:this.selfMouseOut,timeout:1e3,interval:40})},f}(b.Views.Base),b.Views.Field=function(d){function f(){return this.mediaReRender=e(this.mediaReRender,this),f.__super__.constructor.apply(this,arguments)}return c(f,d),f.prototype.events={"click .vp-editable.vp-inline":"focus","click .vp-editable.vp-block":"focusBlock","click vp-image > .vp-choose-image":"imageClick","keyup .vp-editable.vp-inline":"keyup","keypress .vp-editable.vp-inline":"keypress","blur textarea.vp-html":"blurTextarea","blur textarea.vp-media":"blurMedia","blur textarea.vp-shortcode":"blurShortcode","blur .vp-editable":"blur","blur vp-image-link":"blurImageLink","keypress vp-image-link":"keypressImageLink","keyup vp-image-link":"keyupImageLink","drag:stop":"mediaReRender"},f.prototype.tagName="div",f.prototype.className="field-wrap",f.prototype.initialize=function(){var a;return b.log("Field.initialize"),this.editing=("shortcode"===(a=this.model.get("slug"))||"media"===a||"html"===a||"mailchimp"===a||"aweber"===a)&&this.isEmptyishHTML(this.model.get("value")),this.listenTo(this.model,"editMode",this.editMode),this.listenTo(this.model,"editLink:show",this.editLink),this.listenTo(this.model,"chooseImage",this.chooseImage),this.listenTo(this.model,"add",this.postRender)},f.prototype.isEmptyishHTML=function(a){return _.isString(a)?_.isEmpty(this.stripScriptTags(a).trim()):!1},f.prototype.stripScriptTags=function(a){return _.isString(a)?a.replace(/<script[^>]*>.*?<\/script>/gi,""):a},f.prototype.prepare=function(){var a;return a=_.extend(this.model.toJSON(),{editing:this.editing}),a.value&&!this.editing&&(a.value=this.stripScriptTags(a.value)),a},f.prototype.editMode=function(a){return b.log("editMode",a),this.editing=a,this.render(),this.postRender(),this.editing?this.textarea.focus():void 0},f.prototype.editLink=function(){return this.imageLink.slideDown({duration:250,start:function(a){return function(){return a.imageLink.css({display:"block"})}}(this)}),this.imageLink.find("input").focus().select()},f.prototype.focus=function(){return b.log("focus"),this.editable.focus(),"Add text here"===this.editable.html()?document.execCommand("selectAll",!1,null):void 0},f.prototype.focusBlock=function(){return b.log("focusBlock"),"<p>Add text here</p>"===this.editable.html()?document.execCommand("selectAll",!1,null):void 0},f.prototype.blur=function(){return this.model.set({value:this.editable.html()})},f.prototype.blurTextarea=function(){return this.model.set({value:this.textarea.val().trim()}),this.isEmptyishHTML(this.model.get("value"))?void 0:this.model.trigger("editMode",!1,this.model)},f.prototype.blurMedia=function(){return this.blurTextarea(),this.fetchMedia()},f.prototype.fetchMedia=function(){var a,c;if("media"===this.model.get("slug"))return c={context:this,data:{method:"oembed",url:this.model.get("value")}},b.log("options.data",c.data),a=wp.ajax.send("velocity-page",c),a.done(function(a){return this.model.set(null!=(null!=a?a.html:void 0)?{html:a.html}:{html:this.model.get("value")}),this.model.trigger("editMode",!1,this.model)})},f.prototype.blurShortcode=function(){return this.blurTextarea(),this.fetchShortcode()},f.prototype.fetchShortcode=function(){var a,c;if("shortcode"===this.model.get("slug"))return a={context:this,data:{method:"shortcode",shortcode:this.model.get("value")}},b.log("options.data",a.data),c=wp.ajax.send("velocity-page",a),c.done(function(a){return this.model.set(null!=(null!=a?a.html:void 0)?{html:a.html}:{html:this.model.get("value")}),this.model.trigger("editMode",!1,this.model)})},f.prototype.keyupImageLink=function(){return this.checkImageLink()},f.prototype.keypressImageLink=function(a){return 13===a.which?this.blurImageLink():void 0},f.prototype.blurImageLink=function(){return this.checkImageLink(),this.model.set({url:this.imageLinkInput.val()}),this.imageLink.slideUp({duration:250,complete:function(a){return function(){return a.imageLink.hide()}}(this)})},f.prototype.checkImageLink=function(){var a,b,c,d,e,f;if(d=this.imageLink.find("input"),f=d.val(),f.length&&0!==f.indexOf("/")){for(b=["http://","https://","mailto:","ftp://","feed:"],b=function(){var c,d,e;for(e=[],c=0,d=b.length;d>c;c++)a=b[c],e.push(a.substr(0,f.length));return e}(),c=0,e=b.length;e>c;c++)if(a=b[c],0===f.indexOf(a))return;return d.val("http://"+d.val())}},f.prototype.keyup=function(a){return this.model.trigger("itemHeightCheck")},f.prototype.keypress=function(a){return 13!==a.which||a.shiftKey?void 0:(this.editable.blur(),this.model.set({value:this.editable.html()}),!1)},f.prototype.imageClick=function(a){return a.preventDefault(),this.chooseImage()},f.prototype.chooseImage=function(){return this.frame=wp.media.frames.vpframe=wp.media({title:"Media Uploader",button:{text:"Choose Image"},multiple:!1,library:{type:"image"}}),this.frame.on("select",function(a){return function(){var c,d,e;return c=a.frame.state().get("selection").first().toJSON(),e=(null!=(d=c.sizes.large)?d.url:void 0)||c.sizes.full.url,b.log("ATTACHMENT",c),a.model.set({value:e}),a.model.unset("width"),a.model.unset("height"),a.render(),a.postRender()}}(this)),this.frame.open()},f.prototype.imageResizable=function(){var b,c,d;return this.imageWrap=this.$("vp-image"),this.image=this.$("img",this.imageWrap),this.image.length&&(this.model.get("width"&&this.model.get("height"))&&this.imageWrap.css({width:this.model.get("width")+"px",height:this.model.get("height")+"px"}),b=this.model,this.imageWrap.is(".ui-resizable")||this.imageWrap.resizable({handles:"se, sw",aspectRatio:this.image.width()/this.image.height(),maxWidth:this.imageWrap.parent().width(),minWidth:20,minHeight:20,resize:function(c,d){var e;return e=a(this),e.width()===e.resizable("option","maxWidth")?(b.unset("width"),b.unset("height")):b.set({width:e.width(),height:e.height()}),e.css({left:"auto",right:"auto",top:"auto",bottom:"auto"})}}),this.imageWrap.width()>this.imageWrap.parent().width())?(this.imageWrap.resizable("option","maxWidth",this.imageWrap.parent().width()),d=this.imageWrap.parent().width(),c=d*(1/this.imageWrap.resizable("option","aspectRatio")),this.imageWrap.css({width:d+"px",height:c+"px"})):void 0},f.prototype.imgResize=function(){var a,b;return b=this.$("vp-image"),a=this.$("img",b),b.css({height:""}),a.height()&&b.css({height:a.height()+"px"}),this.imageWrap.is(".ui-resizable")?this.imageWrap.resizable("option","maxWidth",this.imageWrap.parent().width()):void 0},f.prototype.mediaReRender=function(a){return console.log("mediaReRender"),this.model.trigger("editMode",!1,this.model)},f.prototype.mediaRender=function(){var b;return"media"!==this.model.get("slug")||(b=this.model.get("value"),a(a.parseHTML(b,document,!0)).appendTo("body").remove(),this.editing)?void 0:a('<div class="vp-mask"></div>').appendTo(this.$el).height(this.$el.height()+"px").width(this.$el.width()+"px")},f.prototype.postRender=function(){return b.log("postRender()"),this.mediaRender(),this.fitVids(),this.imageResizable(),this.imgResize(),this.editable=this.$(".vp-editable"),this.textarea=this.$("textarea.vp-html, textarea.vp-media, textarea.vp-shortcode"),this.imageLink=this.$("vp-image-link"),this.imageLinkInput=this.imageLink.find("input"),"spacer"===this.model.get("slug")?(this.spacer=this.$(".vp-spacer"),this.spacerValue=this.$(".vp-spacer-value"),this.spacerValue.change(function(a){return function(){return a.slider.slider("value",a.spacerValue.val())}}(this)),this.slider=this.$(".vp-spacer-slider"),this.sliderSlide=function(a){return function(b,c){return a.$(".vp-spacer-value").val(c.value),a.model.set({value:c.value}),a.spacer.css({height:c.value+"px"})}}(this),this.slider.slider({value:this.model.get("value")||40,min:40,max:300,change:this.sliderSlide,start:function(){return b.events.trigger("drag:start","spacer")},stop:function(){return b.events.trigger("drag:stop","spacer")},slide:this.sliderSlide})):void 0},f.prototype.fitVids=function(){return this.$el.fitVids()},f.prototype.ready=function(){return b.log("Field.ready"),a(window).on("resize",function(a){return function(){return a.imgResize()}}(this)),this.postRender(),this.fetchMedia(),this.fetchShortcode(),this.editable.length&&"Add text here"===this.editable.val()&&this.editable.val(""),this.$el.attr("id")||this.$el.attr("id",this.model.cid),this.editable.length&&(this.editable.hasClass("vp-block")&&"Add text here"===this.editable.html()&&this.editable.html("<p>Add text here</p>"),this.editable.hasClass("vp-inline")&&this.editable.prop("contenteditable",!0),null==window.tinymce||this.editable.hasClass("vp-inline")||b.mceInit("#"+this.$el.attr("id")+" .vp-editable.vp-block")),this.model.get("autofocus")?(b.log("autofocus"),this.model.unset("autofocus"),this.editable.hasClass("vp-block")?(this.editable.focus(),document.execCommand("selectAll",!1,null)):this.editable.click()):this.model.unset("autofocus"),this.model.chooseImageImmediately&&this.$("vp-image > .vp-choose-image").length?this.chooseImage():void 0},f}(b.Views.Base),b.page=new b.Models.Page({}),b.pageView=new b.Views.Page({model:b.page}),b.start()}).call(this);
//# sourceMappingURL=editor.min.js.map